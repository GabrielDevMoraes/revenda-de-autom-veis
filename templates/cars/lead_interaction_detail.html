{% extends 'base.html' %}
{% load static %}

{% block title %}Detalhes do Lead - Cental{% endblock %}

{% block content %}
    <!-- Header Start -->
    <div class="container-fluid bg-breadcrumb">
        <div class="container text-center py-5" style="max-width: 900px;">
            <h4 class="text-white display-4 mb-4 wow fadeInDown" data-wow-delay="0.1s">Detalhes do Lead</h4>
            <ol class="breadcrumb d-flex justify-content-center mb-0 wow fadeInDown" data-wow-delay="0.3s">
                <li class="breadcrumb-item"><a href="{% url 'home' %}">Início</a></li>
                <li class="breadcrumb-item"><a href="{% url 'dashboard_home' %}">Painel do Vendedor</a></li>
                <li class="breadcrumb-item"><a href="{% url 'lead_interaction_list' %}">Meus Leads</a></li>
                <li class="breadcrumb-item active text-primary">Detalhes</li>
            </ol>    
        </div>
    </div>
    <!-- Header End -->

    <!-- Lead Interaction Detail Start -->
    <div class="container-fluid py-5">
        <div class="container py-5">
            <div class="text-center mx-auto pb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 800px;">
                <h1 class="display-5 text-capitalize mb-3">Interação com <span class="text-primary">{{ lead_interaction.cliente.nome_completo }}</span></h1>
                <p class="mb-0">Detalhes da interação referente ao veículo: <strong>{{ lead_interaction.carro.marca }} {{ lead_interaction.carro.modelo }}</strong></p>
            </div>

            <div class="row justify-content-center">
                <div class="col-lg-8 col-md-10 wow fadeInUp" data-wow-delay="0.3s">
                    <div class="bg-light p-5 rounded shadow">
                        <h4 class="mb-4 text-primary">Informações da Interação</h4>
                        <p><strong>Carro de Interesse:</strong> <a href="{% url 'car_detail' lead_interaction.carro.pk %}" class="text-dark">{{ lead_interaction.carro.marca }} {{ lead_interaction.carro.modelo }} ({{ lead_interaction.carro.ano }})</a></p>
                        <p><strong>Cliente/Lead:</strong> {{ lead_interaction.cliente.nome_completo }} ({{ lead_interaction.cliente.email }})</p>
                        <p><strong>Telefone do Cliente:</strong> {{ lead_interaction.cliente.telefone|default:"Não informado" }}</p>
                        <p>
                            <strong>WhatsApp do Cliente:</strong> 
                            {% if lead_interaction.cliente.whatsapp_number %}
                                {{ lead_interaction.cliente.whatsapp_number }}
                                <a href="{% url 'initiate_whatsapp_conversation' lead_interaction.pk %}" target="_blank" title="Iniciar conversa no WhatsApp">
                                    <i class="fab fa-whatsapp text-success ms-2" style="font-size: 1.2em;"></i>
                                </a>
                            {% else %}
                                Não informado
                            {% endif %}
                        </p>
                        <p><strong>Vendedor Responsável:</strong> 
                            {% if lead_interaction.vendedor %}
                                {{ lead_interaction.vendedor.get_full_name|default:lead_interaction.vendedor.username }}
                            {% else %}
                                <span class="text-muted">Não Atribuído</span>
                                <form action="{% url 'claim_lead' lead_interaction.pk %}" method="post" class="d-inline ms-2">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-success rounded-pill">Reivindicar Lead</button>
                                </form>
                            {% endif %}
                        </p>
                        <p><strong>Data da Interação:</strong> {{ lead_interaction.data_interacao|date:"d/m/Y H:i" }}</p>
                        <p><strong>Última Atualização:</strong> {{ lead_interaction.ultima_atualizacao|date:"d/m/Y H:i" }}</p>
                        
                        <h5 class="mt-4 text-primary">Atualizar Status e Notas</h5>
                        <form method="post">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="{{ form.status.id_for_label }}" class="form-label">Status Atual:</label>
                                {{ form.status }}
                            </div>
                            <div class="mb-3">
                                <label for="{{ form.observacoes.id_for_label }}" class="form-label">Observações:</label>
                                {{ form.observacoes }}
                            </div>
                            <button type="submit" class="btn btn-primary rounded-pill py-2 px-4 mt-3">Salvar Alterações</button>
                            <a href="{% url 'lead_interaction_list' %}" class="btn btn-secondary rounded-pill py-2 px-4 mt-3 ms-2">Voltar para Leads</a>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Lead Interaction Detail End -->
{% endblock %}
